<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings | Focus Clinical Admin</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="../assets/images/favicon.png">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Geist:wght@400;500;600;700&family=Instrument+Sans:ital,wght@0,400;0,500;0,600;1,400&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="admin-styles.css">
</head>

<body class="admin-body">
    <!-- Sidebar -->
    <aside class="admin-sidebar">
        <div class="sidebar-header">
            <img src="../assets/images/admin-logo.png" alt="Focus Clinical" class="sidebar-logo">
        </div>
        <nav class="sidebar-nav">
            <a href="dashboard.html" class="nav-item">
                <i class="fas fa-th-large"></i>
                <span>Dashboard</span>
            </a>
            <a href="appointments.html" class="nav-item">
                <i class="fas fa-calendar-check"></i>
                <span>Appointments</span>
            </a>
            <a href="contacts.html" class="nav-item">
                <i class="fas fa-envelope"></i>
                <span>Contact Messages</span>
            </a>
            <a href="settings.html" class="nav-item active">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </a>
        </nav>
        <div class="sidebar-footer">
            <a href="../index.html" class="nav-item">
                <i class="fas fa-globe"></i>
                <span>View Website</span>
            </a>
            <button class="nav-item logout-btn" onclick="adminLogout()">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="admin-main">
        <header class="admin-topbar">
            <div class="topbar-left">
                <button class="menu-toggle" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <h1>Settings</h1>
            </div>
            <div class="topbar-right">
                <div class="admin-user">
                    <i class="fas fa-user-circle"></i>
                    <span>helpdesk@focusdiagnostics.co.ke</span>
                </div>
            </div>
        </header>

        <div class="admin-content">
            <!-- Change Password -->
            <div class="settings-card">
                <div class="card-header">
                    <h2><i class="fas fa-key"></i> Change Password</h2>
                </div>
                <div class="card-body">
                    <div class="alert alert-success" id="successAlert" style="display: none;">
                        <i class="fas fa-check-circle"></i>
                        <span id="successMessage">Password changed successfully!</span>
                    </div>
                    <div class="alert alert-error" id="errorAlert" style="display: none;">
                        <i class="fas fa-exclamation-circle"></i>
                        <span id="errorMessage">Error occurred</span>
                    </div>

                    <form class="settings-form" id="passwordForm">
                        <div class="form-group">
                            <label for="currentPassword">Current Password</label>
                            <input type="password" id="currentPassword" placeholder="Enter current password" required>
                        </div>
                        <div class="form-group">
                            <label for="newPassword">New Password</label>
                            <input type="password" id="newPassword" placeholder="Enter new password (min 8 characters)"
                                required minlength="8">
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">Confirm New Password</label>
                            <input type="password" id="confirmPassword" placeholder="Confirm new password" required
                                minlength="8">
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Update Password
                        </button>
                    </form>
                </div>
            </div>

            <!-- Account Info -->
            <div class="settings-card" style="margin-top: 24px;">
                <div class="card-header">
                    <h2><i class="fas fa-user-cog"></i> Account Information</h2>
                </div>
                <div class="card-body">
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">Admin Email</div>
                            <div class="detail-value">helpdesk@focusdiagnostics.co.ke</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Role</div>
                            <div class="detail-value">Administrator</div>
                        </div>
                        <div class="detail-item full">
                            <div class="detail-label">Support</div>
                            <div class="detail-value">
                                For technical assistance, contact the development team at
                                <a href="mailto:support@gmcreative.co.ke"
                                    style="color: var(--primary);">support@gmcreative.co.ke</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Data Management -->
            <div class="settings-card" style="margin-top: 24px;">
                <div class="card-header">
                    <h2><i class="fas fa-database"></i> Data Management</h2>
                </div>
                <div class="card-body">
                    <p style="color: var(--text-muted); margin-bottom: 20px;">
                        Export all your data or clear specific records. Use these options with caution.
                    </p>
                    <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                        <button class="btn btn-export" onclick="exportAllData()">
                            <i class="fas fa-download"></i> Export All Data
                        </button>
                        <button class="btn btn-outline" style="border-color: #ef4444; color: #ef4444;"
                            onclick="clearAppointments()">
                            <i class="fas fa-trash"></i> Clear Appointments
                        </button>
                        <button class="btn btn-outline" style="border-color: #ef4444; color: #ef4444;"
                            onclick="clearContacts()">
                            <i class="fas fa-trash"></i> Clear Messages
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="admin.js"></script>
    <script>
        requireAuth();

        document.getElementById('passwordForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            // Hide previous alerts
            document.getElementById('successAlert').style.display = 'none';
            document.getElementById('errorAlert').style.display = 'none';

            // Validate
            if (newPassword !== confirmPassword) {
                showError('New passwords do not match');
                return;
            }

            const result = changePassword(currentPassword, newPassword);

            if (result.success) {
                showSuccess(result.message);
                this.reset();
            } else {
                showError(result.message);
            }
        });

        function showSuccess(message) {
            document.getElementById('successMessage').textContent = message;
            document.getElementById('successAlert').style.display = 'flex';
        }

        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorAlert').style.display = 'flex';
        }

        function exportAllData() {
            const data = {
                appointments: getAppointments(),
                contacts: getContacts(),
                exportDate: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `focus_clinical_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        function clearAppointments() {
            if (confirm('Are you sure you want to delete ALL appointments? This cannot be undone.')) {
                if (confirm('Final confirmation: Delete all appointment records?')) {
                    localStorage.removeItem(CONFIG.dataKeys.appointments);
                    alert('All appointments have been cleared.');
                }
            }
        }

        function clearContacts() {
            if (confirm('Are you sure you want to delete ALL contact messages? This cannot be undone.')) {
                if (confirm('Final confirmation: Delete all contact messages?')) {
                    localStorage.removeItem(CONFIG.dataKeys.contacts);
                    alert('All contact messages have been cleared.');
                }
            }
        }

        function toggleSidebar() {
            document.querySelector('.admin-sidebar').classList.toggle('active');
        }
    </script>
</body>

</html>